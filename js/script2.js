const translations = {
  fr: {
    navAccueil: "Accueil",
    navProjets: "Projets",
    navContact: "Contact",
    navAPropos: "À propos",
    navInfo: "Info",
    navCV: "CV",
    theme: 'Thème',

    proj1title: "Script Python snake",
    proj1text: "Clicker pour Télécharger un fichier.zip contenant le Snake.",
    proj2title: "Script Python Tetris",
    proj2text: "Clicker pour Télécharger un fichier.zip contenant le Tetris",
    proj3title: "Script Python Pong",
    proj3text: "Clicker pour Télécharger un fichier.zip contenant le Pong",
    proj4title: "Script Python TicTacToe",
    proj4text: "Clicker pour Télécharger un fichier.zip contenant le TicTacToe.",
    proj5title: "Site HTML Responsive",
    proj5text: "Site web responsive et accessible réalisé en HTML/CSS/PHP.",
    proj6title: "Jeu en JS",
    proj6text: "Mini-jeu réalisé avec JavaScript.",
    proj7title: "Projet PHP", 
    proj7text: "Projets de développement utilisant PHP.", 

    proj1desc: "Un jeu de serpent classique développé en Python avec Pygame. Le joueur contrôle un serpent qui grandit à chaque nourriture consommée. Le jeu se termine si le serpent se heurte à un mur ou à lui-même.",
    proj2desc: "Une implémentation du jeu Tetris en Python. Les pièces tombent du haut et le joueur doit les positionner pour remplir des lignes. Chaque ligne complète est supprimée et rapporte des points.",
    proj3desc: "Le jeu Pong classique en Python. Deux joueurs contrôlent des raquettes pour faire rebondir une balle. C'est un jeu multijoueur simple et addictif.",
    proj4desc: "Le jeu du Morpion (Tic-Tac-Toe) en Python. Jouez contre l'ordinateur avec une intelligence artificielle simple. C'est un projet pédagogique pour apprendre les algorithmes de base.",
    proj5desc: "Un site web professionnel et responsive réalisé dans le cadre du projet SAE203. Accessible sur tous les appareils (desktop, tablet, mobile) avec un design moderne et épuré.",
    proj6desc: "Un mini-jeu interactif créé avec JavaScript vanilla. Testez vos réflexes et essayez de battre le meilleur score. Code moderne et optimisé.",
    proj7desc: "Description détaillée du projet PHP.", 

    modalDownload: "Télécharger",
    modalVisit: "Visiter",
    modalClose: "Fermer",
    
    allRightsReserved: "Tous droits réservés",
    footerMentions: "Mentions Légales"
  },
  en: {
    navAccueil: "Home",
    navProjets: "Projects",
    navContact: "Contact",
    navAPropos: "About",
    navInfo: "Info",
    navCV: "CV",
    theme: 'Theme',

    proj1title: "Python Snake Script",
    proj1text: "Click to download a .zip file containing the Snake game.",
    proj2title: "Python Tetris Script",
    proj2text: "Click to download a .zip file containing the Tetris game.",
    proj3title: "Python Pong Script",
    proj3text: "Click to download a .zip file containing the Pong game.",
    proj4title: "Python TicTacToe Script",
    proj4text: "Click to download a .zip file containing the TicTacToe game.",
    proj5title: "Responsive HTML Website",
    proj5text: "Responsive and accessible site made with HTML/CSS/PHP.",
    proj6title: "JS Game",
    proj6text: "Mini-game made with JavaScript.",
    proj7title: "PHP Project", 
    proj7text: "Development projects using PHP.", 


    proj1desc: "A classic Snake game developed in Python with Pygame. The player controls a snake that grows with each food eaten. The game ends if the snake hits a wall or itself.",
    proj2desc: "An implementation of Tetris in Python. Pieces fall from the top, and the player must position them to complete lines. Each completed line is removed and gives points.",
    proj3desc: "The classic Pong game in Python. Two players control paddles to bounce a ball. It's a simple and addictive multiplayer game.",
    proj4desc: "Tic-Tac-Toe in Python. Play against the computer with a simple AI. This is an educational project to learn basic algorithms.",
    proj5desc: "A professional and responsive website made for the SAE203 project. Accessible on all devices (desktop, tablet, mobile) with a modern, clean design.",
    proj6desc: "An interactive mini-game created with vanilla JavaScript. Test your reflexes and try to beat the high score. Modern and optimized code.",
    proj7desc: "Detailed description of the PHP project.", 

    modalDownload: "Download",
    modalVisit: "Visit",
    modalClose: "Close",
    
    allRightsReserved: "All rights reserved",
    footerMentions: "Legal Notice"
  },
  pt: {
    navAccueil: "Início",
    navProjets: "Projetos",
    navContact: "Contato",
    navAPropos: "Sobre",
    navInfo: "Info",
    navCV: "CV",
    theme: 'Tema',

    proj1title: "Script Python Snake",
    proj1text: "Clique para baixar um arquivo .zip contendo o jogo Snake.",
    proj2title: "Script Python Tetris",
    proj2text: "Clique para baixar um arquivo .zip contendo o jogo Tetris.",
    proj3title: "Script Python Pong",
    proj3text: "Clique para baixar um arquivo .zip contendo o jogo Pong.",
    proj4title: "Script Python TicTacToe",
    proj4text: "Clique para baixar um arquivo .zip contendo o jogo TicTacToe.",
    proj5title: "Site HTML Responsivo",
    proj5text: "Site responsivo e acessível feito com HTML/CSS/PHP.",
    proj6title: "Jogo JS",
    proj6text: "Mini-jogo feito com JavaScript.",
    proj7title: "Projeto PHP", 
    proj7text: "Projetos de desenvolvimento usando PHP.", 

    proj1desc: "Um jogo clássico de Snake desenvolvido em Python com Pygame. O jogador controla uma cobra que cresce a cada comida consumida. O jogo termina se a cobra bater em uma parede ou em si mesma.",
    proj2desc: "Uma implementação do jogo Tetris em Python. As peças caem do topo e o jogador deve posicioná-las para completar linhas. Cada linha completa é removida e gera pontos.",
    proj3desc: "O jogo clássico Pong em Python. Dois jogadores controlam as raquetes para rebater a bola. É um jogo multiplayer simples e viciante.",
    proj4desc: "O jogo da velha (Tic-Tac-Toe) em Python. Jogue contra o computador com uma IA simples. É um projeto educacional para aprender algoritmos básicos.",
    proj5desc: "Um site profissional e responsivo feito para o projeto SAE203. Acessível em todos os dispositivos (desktop, tablet, mobile) com design moderno e limpo.",
    proj6desc: "Um mini-jogo interativo criado com JavaScript vanilla. Teste seus reflexos e tente bater o recorde. Código moderno e otimizado.",
    proj7desc: "Descrição detalhada do projeto PHP.", 

    modalDownload: "Baixar",
    modalVisit: "Visitar",
    modalClose: "Fechar",
    
    allRightsReserved: "Todos os direitos reservados",
    footerMentions: "Aviso Legal"
  },
  es: {
    navAccueil: "Inicio",
    navProjets: "Proyectos",
    navContact: "Contacto",
    navAPropos: "Acerca de",
    navInfo: "Info",
    navCV: "CV",
    theme: 'Tema',

    proj1title: "Script Python Snake",
    proj1text: "Haga clic para descargar un archivo .zip que contiene el juego Snake.",
    proj2title: "Script Python Tetris",
    proj2text: "Haga clic para descargar un archivo .zip que contiene el juego Tetris.",
    proj3title: "Script Python Pong",
    proj3text: "Haga clic para descargar un archivo .zip que contiene el juego Pong.",
    proj4title: "Script Python TicTacToe",
    proj4text: "Haga clic para descargar un archivo .zip que contiene el juego TicTacToe.",
    proj5title: "Sitio Web HTML Responsivo",
    proj5text: "Sitio responsive y accesible hecho con HTML/CSS/PHP.",
    proj6title: "Juego JS",
    proj6text: "Mini-juego hecho con JavaScript.",
    proj7title: "Proyecto PHP", 
    proj7text: "Proyectos de desarrollo usando PHP.",

    proj1desc: "Un juego clásico de Snake desarrollado en Python con Pygame. El jugador controla una serpiente que crece con cada comida consumida. El juego termina si la serpiente choca con una pared o consigo misma.",
    proj2desc: "Una implementación del juego Tetris en Python. Las piezas caen desde la parte superior y el jugador debe posicionarlas para completar líneas. Cada línea completada se elimina y genera puntos.",
    proj3desc: "El clásico juego Pong en Python. Dos jugadores controlan las raquetas para rebotar la pelota. Es un juego multijugador simple y adictivo.",
    proj4desc: "El juego del Gato (Tic-Tac-Toe) en Python. Juega contra la computadora con una IA simple. Es un proyecto educativo para aprender algoritmos básicos.",
    proj5desc: "Un sitio web profesional y responsive hecho para el proyecto SAE203. Accesible en todos los dispositivos (desktop, tablet, mobile) con diseño moderno y limpio.",
    proj6desc: "Un mini-juego interactivo creado con JavaScript vanilla. Prueba tus reflejos e intenta batir la puntuación más alta. Código moderno y optimizado.",
    proj7desc: "Descripción detallada del proyecto PHP.",

    modalDownload: "Descargar",
    modalVisit: "Visitar",
    modalClose: "Cerrar",
    
    allRightsReserved: "Todos los derechos reservados",
    footerMentions: "Aviso Legal"
  }
};


const projectDetails = {
  1: { images: ["../img/snake.png", "../img/snake.png", "../img/snake.png"], languages: ["Python", "Pygame"], download: "../downloads/snake.zip" },
  2: { images: ["../img/tetris.png", "../img/tetris.png", "../img/tetris.png"], languages: ["Python", "Pygame"], download: "../downloads/Tetris.zip" },
  3: { images: ["../img/pong.png", "../img/pong.png", "../img/pong.png"], languages: ["Python", "Pygame"], download: "../downloads/Pong.zip" },
  4: { images: ["../img/tictactoe.png", "../img/tictactoe.png", "../img/tictactoe.png"], languages: ["Python"], download: "../downloads/TicTacToe.zip" },
  5: { images: ["../img/SAE203.png", "../img/SAE203.png", "../img/SAE203.png"], languages: ["HTML", "CSS", "PHP"], link: "http://81.194.40.26/~antunes--oliveira/SAE203/" },
  6: { images: ["../img/jeu-js.png", "../img/jeu-js.png", "../img/jeu-js.png"], languages: ["JavaScript", "HTML", "CSS"], link: "../projets/jeu-js.html" },
  7: { images: ["../img/php_project.png", "../img/php_project.png", "../img/php_project.png"], languages: ["PHP","CSS"], link: "../projets/" } 
};


// Variables d'état du carrousel
let currentSlideIndex = 0;
let currentProjectId = null;


// ===================================================================
// LOGIQUE DE TRADUCTION ET D'AFFICHAGE DU TEXTE
// ===================================================================

function applyText(lang) {
  const t = translations[lang] || translations.fr;
  const currentUrl = window.location.href;

  // Mise à jour des textes des projets sur la carte
  for (let i = 1; i <= 7; i++) {
    const card = document.querySelector(`.project-card[data-project-id="${i}"]`);
    if (card) {
      card.querySelector('h3').textContent = t[`proj${i}title`];
      card.querySelector('p').textContent = t[`proj${i}text`];
      
      // Mise à jour de la description pour l'accessibilité
      card.dataset.description = t[`proj${i}desc`]; 
    }
  }

  // Mise à jour des textes génériques (navigation, pied de page)
  document.querySelectorAll('[data-translate]').forEach(el => {
    const key = el.getAttribute('data-translate');
    if (t[key]) {
      el.textContent = t[key];
    }
  });

  // Mise à jour du bouton de la modale pour la langue
  const actionBtn = document.getElementById('modalActionBtn');
  if (actionBtn) {
      if (actionBtn.dataset.action === 'download') {
          actionBtn.textContent = t.modalDownload;
      } else if (actionBtn.dataset.action === 'link') {
          actionBtn.textContent = t.modalVisit;
      }
  }
}

// ===================================================================
// LOGIQUE DU CARROUSEL
// ===================================================================

function showSlides(n) {
    const details = projectDetails[currentProjectId];
    const images = details ? details.images : [];
    const slidesContainer = document.getElementById('slides-container');
    const dotsContainer = document.getElementById('dot-container');

    if (!images || images.length === 0) {
        slidesContainer.innerHTML = '';
        dotsContainer.innerHTML = '';
        return;
    }

    if (n > images.length - 1) {
        currentSlideIndex = 0;
    }
    if (n < 0) {
        currentSlideIndex = images.length - 1;
    }

    // Affichage des slides par transformation
    // Le slidesContainer DOIT avoir la largeur totale de TOUTES les slides (e.g., 300% pour 3 slides)
    slidesContainer.style.transform = `translateX(-${currentSlideIndex * 100}%)`;

    // Mise à jour des points
    dotsContainer.innerHTML = '';
    for (let i = 0; i < images.length; i++) {
        const dot = document.createElement('span');
        dot.className = 'dot';
        if (i === currentSlideIndex) {
            dot.classList.add('active');
        }
        // Utilisation de i pour naviguer directement au slide
        dot.onclick = () => showSlides(i); 
        dotsContainer.appendChild(dot);
    }
}

function plusSlides(n) {
    // n doit être -1 ou 1
    currentSlideIndex += n;
    showSlides(currentSlideIndex);
}

function closeModal() {
    document.getElementById('projectModal').classList.remove('active');
}

function handleModalAction() {
    const btn = document.getElementById('modalActionBtn');
    const link = btn.dataset.link;
    if (link) {
        if (btn.dataset.action === 'download') {
            // Création d'un lien temporaire pour forcer le téléchargement
            const a = document.createElement('a');
            a.href = link;
            a.download = ''; // force le navigateur à télécharger
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        } else if (btn.dataset.action === 'link') {
            window.open(link, '_blank'); // Ouvrir dans un nouvel onglet
        }
    }
}

// ===================================================================
// LOGIQUE D'OUVERTURE DE LA MODALE
// ===================================================================

function openModal(projectId) {
    const modal = document.getElementById('projectModal');
    const details = projectDetails[projectId];
    const card = document.querySelector(`.project-card[data-project-id="${projectId}"]`);

    if (!details || !card) return;

    // Récupérer la langue actuelle pour la description
    const lang = localStorage.getItem('lang') || 'fr';
    const t = translations[lang] || translations.fr;
    const descKey = `proj${projectId}desc`;
    
    currentProjectId = projectId;
    currentSlideIndex = 0; 
    
    // Remplir les détails du projet
    document.getElementById('modalTitle').textContent = t[`proj${projectId}title`];
    document.getElementById('modalDescription').textContent = t[descKey];

    // Gérer le bouton d'action
    const actionBtn = document.getElementById('modalActionBtn');
    actionBtn.style.display = 'block'; 

    if (details.download) {
        actionBtn.textContent = t.modalDownload;
        actionBtn.dataset.action = 'download';
        actionBtn.dataset.link = details.download;
    } else if (details.link) {
        actionBtn.textContent = t.modalVisit;
        actionBtn.dataset.action = 'link';
        actionBtn.dataset.link = details.link;
    } else {
        actionBtn.style.display = 'none';
        actionBtn.removeAttribute('data-action');
        actionBtn.removeAttribute('data-link');
    }

    // Gérer les tags
    const tagsContainer = document.getElementById('modalTags');
    tagsContainer.innerHTML = details.languages.map(tag => `<span class="tag">${tag}</span>`).join('');

    // Gérer le carrousel
    const images = details.images || [];
    const slidesContainer = document.getElementById('slides-container');
    slidesContainer.innerHTML = '';

    if (images.length > 0) {
        // Crée toutes les slides
        images.forEach(src => {
            const slideDiv = document.createElement('div');
            slideDiv.className = 'slide';
            slideDiv.innerHTML = `<img src="${src}" alt="Project image" />`;
            slidesContainer.appendChild(slideDiv);
        });

        // Met à jour la largeur du conteneur des slides pour la translation CSS
        slidesContainer.style.width = `${images.length * 100}%`;

        // Montre/cache les flèches et points si plus d'une image
        const hasMultipleImages = images.length > 1;
        document.querySelector('.carousel-container .prev').style.display = hasMultipleImages ? 'block' : 'none';
        document.querySelector('.carousel-container .next').style.display = hasMultipleImages ? 'block' : 'none';
        document.getElementById('dot-container').style.display = hasMultipleImages ? 'block' : 'none';
        
        showSlides(0); 
    }


    modal.classList.add('active');
}


// ===================================================================
// Initialisation de la page et gestion des filtres
// ===================================================================

document.addEventListener('DOMContentLoaded', () => {
    // Récupérer tous les éléments nécessaires
    const filterButtons = document.querySelectorAll('#project-filters button');
    const statSegments = document.querySelectorAll('.stat-segment');
    const projectCards = document.querySelectorAll('.project-card');

    // Fonction de filtrage
    function updateFilter(filter) {
        filterButtons.forEach(btn => {
            if (btn.getAttribute('data-filter') === filter) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });

        statSegments.forEach(segment => {
            segment.classList.remove('active', 'inactive');
            if (filter === 'all') {
                segment.classList.add('active');
            } else if (
                (filter === 'python' && segment.classList.contains('stat-python')) ||
                (filter === 'html' && segment.classList.contains('stat-html')) ||
                (filter === 'php' && segment.classList.contains('stat-php')) ||
                (filter === 'js' && segment.classList.contains('stat-js'))
            ) {
                segment.classList.add('active');
            } else {
                segment.classList.add('inactive');
            }
        });
        
        projectCards.forEach(card => {
            const category = card.getAttribute('data-category');
            
            if (filter === 'all' || category === filter) {
                card.style.display = 'block'; 
            } else {
                card.style.display = 'none';
            }
        });
    }

    // Écouteurs pour les boutons de filtre
    filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.getAttribute('data-filter');
            updateFilter(filter);
        });
    });

    // Appliquer le filtre initial
    updateFilter('all');

    // Gestion de la langue
    const langSelect = document.getElementById("langSelect");
    const savedLang = localStorage.getItem("lang") || "fr";
    if (langSelect) {
        langSelect.value = savedLang;
        langSelect.addEventListener("change", e => {
            const lang = e.target.value;
            localStorage.setItem("lang", lang);
            applyText(lang);
        });
    }

    applyText(savedLang);

    // Écouteurs pour les cartes de projet
    projectCards.forEach(card => {
        card.addEventListener('click', () => {
            // openModal(projectId) prend l'ID du projet
            openModal(card.dataset.projectId);
        });
    });

    // Écouteur pour fermer la modale en cliquant à l'extérieur
    window.addEventListener('click', e => {
        if (e.target === document.getElementById('projectModal')) {
            closeModal();
        }
    });

    // Mise à jour de l'année
    const yearEl = document.getElementById('currentYear');
    if (yearEl) yearEl.textContent = new Date().getFullYear();
});