const translations = {
  fr: {
    navAccueil: "Accueil",
    navProjets: "Projets",
    navContact: "Contact",
    navAPropos: "√Ä propos",
    navInfo: "Info",
    navCV: "CV",
    theme: 'üé® Th√®me',

    proj1title: "Script Python snake",
    proj1text: "Clicker pour T√©l√©charger un fichier.zip contenant le Snake.",
    proj2title: "Script Python Tetris",
    proj2text: "Clicker pour T√©l√©charger un fichier.zip contenant le Tetris",
    proj3title: "Script Python Pong",
    proj3text: "Clicker pour T√©l√©charger un fichier.zip contenant le Pong",
    proj4title: "Script Python TicTacToe",
    proj4text: "Clicker pour T√©l√©charger un fichier.zip contenant le TicTacToe.",
    proj5title: "Site HTML Responsive",
    proj5text: "Site web responsive et accessible r√©alis√© en HTML/CSS/PHP.",
    proj6title: "Jeu en JS",
    proj6text: "Mini-jeu r√©alis√© avec JavaScript.",
    proj7title: "Projet PHP", 
    proj7text: "Projets de d√©veloppement utilisant PHP.", 

    proj1desc: "Un jeu de serpent classique d√©velopp√© en Python avec Pygame. Le joueur contr√¥le un serpent qui grandit √† chaque nourriture consomm√©e. Le jeu se termine si le serpent se heurte √† un mur ou √† lui-m√™me.",
    proj2desc: "Une impl√©mentation du jeu Tetris en Python. Les pi√®ces tombent du haut et le joueur doit les positionner pour remplir des lignes. Chaque ligne compl√®te est supprim√©e et rapporte des points.",
    proj3desc: "Le jeu Pong classique en Python. Deux joueurs contr√¥lent des raquettes pour faire rebondir une balle. C'est un jeu multijoueur simple et addictif.",
    proj4desc: "Le jeu du Morpion (Tic-Tac-Toe) en Python. Jouez contre l'ordinateur avec une intelligence artificielle simple. C'est un projet p√©dagogique pour apprendre les algorithmes de base.",
    proj5desc: "Un site web professionnel et responsive r√©alis√© dans le cadre du projet SAE203. Accessible sur tous les appareils (desktop, tablet, mobile) avec un design moderne et √©pur√©.",
    proj6desc: "Un mini-jeu interactif cr√©√© avec JavaScript vanilla. Testez vos r√©flexes et essayez de battre le meilleur score. Code moderne et optimis√©.",
    proj7desc: "Description d√©taill√©e du projet PHP.", 

    modalDownload: "T√©l√©charger",
    modalVisit: "Visiter",
    modalClose: "Fermer",
    
    allRightsReserved: "Tous droits r√©serv√©s",
    footerMentions: "Mentions L√©gales"
  },
  en: {
    navAccueil: "Home",
    navProjets: "Projects",
    navContact: "Contact",
    navAPropos: "About",
    navInfo: "Info",
    navCV: "CV",
    theme: 'üé® Theme',

    proj1title: "Python Snake Script",
    proj1text: "Click to download a .zip file containing the Snake game.",
    proj2title: "Python Tetris Script",
    proj2text: "Click to download a .zip file containing the Tetris game.",
    proj3title: "Python Pong Script",
    proj3text: "Click to download a .zip file containing the Pong game.",
    proj4title: "Python TicTacToe Script",
    proj4text: "Click to download a .zip file containing the TicTacToe game.",
    proj5title: "Responsive HTML Website",
    proj5text: "Responsive and accessible site made with HTML/CSS/PHP.",
    proj6title: "JS Game",
    proj6text: "Mini-game made with JavaScript.",
    proj7title: "PHP Project", 
    proj7text: "Development projects using PHP.", 


    proj1desc: "A classic Snake game developed in Python with Pygame. The player controls a snake that grows with each food eaten. The game ends if the snake hits a wall or itself.",
    proj2desc: "An implementation of Tetris in Python. Pieces fall from the top, and the player must position them to complete lines. Each completed line is removed and gives points.",
    proj3desc: "The classic Pong game in Python. Two players control paddles to bounce a ball. It's a simple and addictive multiplayer game.",
    proj4desc: "Tic-Tac-Toe in Python. Play against the computer with a simple AI. This is an educational project to learn basic algorithms.",
    proj5desc: "A professional and responsive website made for the SAE203 project. Accessible on all devices (desktop, tablet, mobile) with a modern, clean design.",
    proj6desc: "An interactive mini-game created with vanilla JavaScript. Test your reflexes and try to beat the high score. Modern and optimized code.",
    proj7desc: "Detailed description of the PHP project.", 

    modalDownload: "Download",
    modalVisit: "Visit",
    modalClose: "Close",
    
    allRightsReserved: "All rights reserved",
    footerMentions: "Legal Notice"
  },
  pt: {
    navAccueil: "In√≠cio",
    navProjets: "Projetos",
    navContact: "Contato",
    navAPropos: "Sobre",
    navInfo: "Info",
    navCV: "CV",
    theme: 'üé® Tema',

    proj1title: "Script Python Snake",
    proj1text: "Clique para baixar um arquivo .zip contendo o jogo Snake.",
    proj2title: "Script Python Tetris",
    proj2text: "Clique para baixar um arquivo .zip contendo o jogo Tetris.",
    proj3title: "Script Python Pong",
    proj3text: "Clique para baixar um arquivo .zip contendo o jogo Pong.",
    proj4title: "Script Python TicTacToe",
    proj4text: "Clique para baixar um arquivo .zip contendo o jogo TicTacToe.",
    proj5title: "Site HTML Responsivo",
    proj5text: "Site responsivo e acess√≠vel feito com HTML/CSS/PHP.",
    proj6title: "Jogo JS",
    proj6text: "Mini-jogo feito com JavaScript.",
    proj7title: "Projeto PHP", 
    proj7text: "Projetos de desenvolvimento usando PHP.", 

    proj1desc: "Um jogo cl√°ssico de Snake desenvolvido em Python com Pygame. O jogador controla uma cobra que cresce a cada comida consumida. O jogo termina se a cobra bater em uma parede ou em si mesma.",
    proj2desc: "Uma implementa√ß√£o do jogo Tetris em Python. As pe√ßas caem do topo e o jogador deve posicion√°-las para completar linhas. Cada linha completa √© removida e gera pontos.",
    proj3desc: "O jogo cl√°ssico Pong em Python. Dois jogadores controlam as raquetes para rebater a bola. √â um jogo multiplayer simples e viciante.",
    proj4desc: "O jogo da velha (Tic-Tac-Toe) em Python. Jogue contra o computador com uma IA simples. √â um projeto educacional para aprender algoritmos b√°sicos.",
    proj5desc: "Um site profissional e responsivo feito para o projeto SAE203. Acess√≠vel em todos os dispositivos (desktop, tablet, mobile) com design moderno e limpo.",
    proj6desc: "Um mini-jogo interativo criado com JavaScript vanilla. Teste seus reflexos e tente bater o recorde. C√≥digo moderno e otimizado.",
    proj7desc: "Descri√ß√£o detalhada do projeto PHP.", 

    modalDownload: "Baixar",
    modalVisit: "Visitar",
    modalClose: "Fechar",
    
    allRightsReserved: "Todos os direitos reservados",
    footerMentions: "Aviso Legal"
  }
};

// ‚ö° D√©tails des projets pour le modal et le carrousel
// ATTENTION : Pour √©viter les erreurs 'File Not Found', l'image de couverture est dupliqu√©e 3 fois.
// REMPLACER ces chemins plus tard par des captures d'√©cran r√©elles.
const projectDetails = {
  1: { images: ["../img/snake.png", "../img/snake.png", "../img/snake.png"], languages: ["Python", "Pygame"], download: "../downloads/snake.zip" },
  2: { images: ["../img/tetris.png", "../img/tetris.png", "../img/tetris.png"], languages: ["Python", "Pygame"], download: "../downloads/Tetris.zip" },
  3: { images: ["../img/pong.png", "../img/pong.png", "../img/pong.png"], languages: ["Python", "Pygame"], download: "../downloads/Pong.zip" },
  4: { images: ["../img/tictactoe.png", "../img/tictactoe.png", "../img/tictactoe.png"], languages: ["Python"], download: "../downloads/TicTacToe.zip" },
  5: { images: ["../img/SAE203.png", "../img/SAE203.png", "../img/SAE203.png"], languages: ["HTML", "CSS", "PHP"], link: "http://81.194.40.26/~antunes--oliveira/SAE203/" },
  6: { images: ["../img/jeu-js.png", "../img/jeu-js.png", "../img/jeu-js.png"], languages: ["JavaScript", "HTML", "CSS"], link: "../projets/jeu-js.html" },
  7: { images: ["../img/php_project.png", "../img/php_project.png", "../img/php_project.png"], languages: ["PHP","CSS"], link: "../projets/" } 
};


// Variables d'√©tat du carrousel
let currentSlideIndex = 0;
let currentProjectId = null;


// ===================================================================
// LOGIQUE DE TRADUCTION ET D'AFFICHAGE DU TEXTE
// ===================================================================

function applyText(lang) {
  const t = translations[lang] || translations.fr;
  const currentUrl = window.location.href;

  // Mise √† jour des textes des projets sur la carte
  for (let i = 1; i <= 7; i++) {
    const card = document.querySelector(`.project-card[data-project-id="${i}"]`);
    if (card) {
      card.querySelector('h3').textContent = t[`proj${i}title`];
      card.querySelector('p').textContent = t[`proj${i}text`];
      
      // Mise √† jour de la description pour l'accessibilit√©
      card.dataset.description = t[`proj${i}desc`]; 
    }
  }

  // Mise √† jour des textes g√©n√©riques (navigation, pied de page)
  document.querySelectorAll('[data-translate]').forEach(el => {
    const key = el.getAttribute('data-translate');
    if (t[key]) {
      el.textContent = t[key];
    }
  });

  // Mise √† jour du bouton de la modale pour la langue
  const actionBtn = document.getElementById('modalActionBtn');
  if (actionBtn) {
      if (actionBtn.dataset.action === 'download') {
          actionBtn.textContent = t.modalDownload;
      } else if (actionBtn.dataset.action === 'link') {
          actionBtn.textContent = t.modalVisit;
      }
  }
}

// ===================================================================
// LOGIQUE DU CARROUSEL
// ===================================================================

function showSlides(n) {
    const details = projectDetails[currentProjectId];
    const images = details ? details.images : [];
    const slidesContainer = document.getElementById('slides-container');
    const dotsContainer = document.getElementById('dot-container');

    if (!images || images.length === 0) {
        slidesContainer.innerHTML = '';
        dotsContainer.innerHTML = '';
        return;
    }

    if (n > images.length - 1) {
        currentSlideIndex = 0;
    }
    if (n < 0) {
        currentSlideIndex = images.length - 1;
    }

    // Affichage des slides par transformation
    // Le slidesContainer DOIT avoir la largeur totale de TOUTES les slides (e.g., 300% pour 3 slides)
    slidesContainer.style.transform = `translateX(-${currentSlideIndex * 100}%)`;

    // Mise √† jour des points
    dotsContainer.innerHTML = '';
    for (let i = 0; i < images.length; i++) {
        const dot = document.createElement('span');
        dot.className = 'dot';
        if (i === currentSlideIndex) {
            dot.classList.add('active');
        }
        // Utilisation de i pour naviguer directement au slide
        dot.onclick = () => showSlides(i); 
        dotsContainer.appendChild(dot);
    }
}

function plusSlides(n) {
    // n doit √™tre -1 ou 1
    currentSlideIndex += n;
    showSlides(currentSlideIndex);
}

function closeModal() {
    document.getElementById('projectModal').classList.remove('active');
}

function handleModalAction() {
    const btn = document.getElementById('modalActionBtn');
    const link = btn.dataset.link;
    if (link) {
        if (btn.dataset.action === 'download') {
            // Cr√©ation d'un lien temporaire pour forcer le t√©l√©chargement
            const a = document.createElement('a');
            a.href = link;
            a.download = ''; // force le navigateur √† t√©l√©charger
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        } else if (btn.dataset.action === 'link') {
            window.open(link, '_blank'); // Ouvrir dans un nouvel onglet
        }
    }
}

// ===================================================================
// LOGIQUE D'OUVERTURE DE LA MODALE
// ===================================================================

function openModal(projectId) {
    const modal = document.getElementById('projectModal');
    const details = projectDetails[projectId];
    const card = document.querySelector(`.project-card[data-project-id="${projectId}"]`);

    if (!details || !card) return;

    // R√©cup√©rer la langue actuelle pour la description
    const lang = localStorage.getItem('lang') || 'fr';
    const t = translations[lang] || translations.fr;
    const descKey = `proj${projectId}desc`;
    
    currentProjectId = projectId;
    currentSlideIndex = 0; 
    
    // Remplir les d√©tails du projet
    document.getElementById('modalTitle').textContent = t[`proj${projectId}title`];
    document.getElementById('modalDescription').textContent = t[descKey];

    // G√©rer le bouton d'action
    const actionBtn = document.getElementById('modalActionBtn');
    actionBtn.style.display = 'block'; 

    if (details.download) {
        actionBtn.textContent = t.modalDownload;
        actionBtn.dataset.action = 'download';
        actionBtn.dataset.link = details.download;
    } else if (details.link) {
        actionBtn.textContent = t.modalVisit;
        actionBtn.dataset.action = 'link';
        actionBtn.dataset.link = details.link;
    } else {
        actionBtn.style.display = 'none';
        actionBtn.removeAttribute('data-action');
        actionBtn.removeAttribute('data-link');
    }

    // G√©rer les tags
    const tagsContainer = document.getElementById('modalTags');
    tagsContainer.innerHTML = details.languages.map(tag => `<span class="tag">${tag}</span>`).join('');

    // G√©rer le carrousel
    const images = details.images || [];
    const slidesContainer = document.getElementById('slides-container');
    slidesContainer.innerHTML = '';

    if (images.length > 0) {
        // Cr√©e toutes les slides
        images.forEach(src => {
            const slideDiv = document.createElement('div');
            slideDiv.className = 'slide';
            slideDiv.innerHTML = `<img src="${src}" alt="Project image" />`;
            slidesContainer.appendChild(slideDiv);
        });

        // Met √† jour la largeur du conteneur des slides pour la translation CSS
        slidesContainer.style.width = `${images.length * 100}%`;

        // Montre/cache les fl√®ches et points si plus d'une image
        const hasMultipleImages = images.length > 1;
        document.querySelector('.carousel-container .prev').style.display = hasMultipleImages ? 'block' : 'none';
        document.querySelector('.carousel-container .next').style.display = hasMultipleImages ? 'block' : 'none';
        document.getElementById('dot-container').style.display = hasMultipleImages ? 'block' : 'none';
        
        showSlides(0); 
    }


    modal.classList.add('active');
}


// ===================================================================
// Initialisation de la page et gestion des filtres
// ===================================================================

document.addEventListener('DOMContentLoaded', () => {
    // R√©cup√©rer tous les √©l√©ments n√©cessaires
    const filterButtons = document.querySelectorAll('#project-filters button');
    const statSegments = document.querySelectorAll('.stat-segment');
    const projectCards = document.querySelectorAll('.project-card');

    // Fonction de filtrage
    function updateFilter(filter) {
        filterButtons.forEach(btn => {
            if (btn.getAttribute('data-filter') === filter) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });

        statSegments.forEach(segment => {
            segment.classList.remove('active', 'inactive');
            if (filter === 'all') {
                segment.classList.add('active');
            } else if (
                (filter === 'python' && segment.classList.contains('stat-python')) ||
                (filter === 'html' && segment.classList.contains('stat-html')) ||
                (filter === 'php' && segment.classList.contains('stat-php')) ||
                (filter === 'js' && segment.classList.contains('stat-js'))
            ) {
                segment.classList.add('active');
            } else {
                segment.classList.add('inactive');
            }
        });
        
        projectCards.forEach(card => {
            const category = card.getAttribute('data-category');
            
            if (filter === 'all' || category === filter) {
                card.style.display = 'block'; 
            } else {
                card.style.display = 'none';
            }
        });
    }

    // √âcouteurs pour les boutons de filtre
    filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const filter = btn.getAttribute('data-filter');
            updateFilter(filter);
        });
    });

    // Appliquer le filtre initial
    updateFilter('all');

    // Gestion de la langue
    const langSelect = document.getElementById("langSelect");
    const savedLang = localStorage.getItem("lang") || "fr";
    if (langSelect) {
        langSelect.value = savedLang;
        langSelect.addEventListener("change", e => {
            const lang = e.target.value;
            localStorage.setItem("lang", lang);
            applyText(lang);
        });
    }

    applyText(savedLang);

    // √âcouteurs pour les cartes de projet
    projectCards.forEach(card => {
        card.addEventListener('click', () => {
            // openModal(projectId) prend l'ID du projet
            openModal(card.dataset.projectId);
        });
    });

    // √âcouteur pour fermer la modale en cliquant √† l'ext√©rieur
    window.addEventListener('click', e => {
        if (e.target === document.getElementById('projectModal')) {
            closeModal();
        }
    });

    // Mise √† jour de l'ann√©e
    const yearEl = document.getElementById('currentYear');
    if (yearEl) yearEl.textContent = new Date().getFullYear();
});